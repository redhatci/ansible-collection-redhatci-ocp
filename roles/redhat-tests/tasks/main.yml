---

- name: "Set Logs path"
  set_fact:
    ts_log_dir: "{{ job_logs.path | default ('/tmp')}}"

- name: "Checking if all nodes in MCP are updated and ready before running RedHat tests"
  k8s_info:
    api_version: machineconfiguration.openshift.io/v1
    kind: MachineConfigPool
    kubeconfig: "{{ dci_cluster_configs_dir }}/kubeconfig"
  register: reg_mcpool_status
  vars:
    status_query: "resources[*].status.conditions[?type=='Updated'].status"
    update_status: "{{ reg_mcpool_status | json_query(status_query) | flatten | unique }}"
  until:
    - update_status == ['True']
  retries: 10
  delay: 10

- name: "redhat-tests : Run openshift conformance tests"
  include_tasks: conformance.yml
  tags:
  - conformance
  when:
    - ts_conformance_tests | string | length > 0
    - ts_registry_certificate is defined

- name: "redhat-tests : Run openshift CSI driver tests"
  include_tasks: csi-tests.yml
  tags:
  - csi-tests
  when:
    - ts_csi_test_manifest | string | length > 0
...
