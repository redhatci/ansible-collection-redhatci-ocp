---
- name: "Extract the listed operators"
  ansible.builtin.shell: |
    set -o pipefail

    # Create operators array for single JQ call
    operators_json='[{% for op in pc_operators %}"{{ op }}"{% if not loop.last %},{% endif %}{% endfor %}]'

    # Single-pass extraction for all operators
    jq --argjson operators "$operators_json" '
      select(.package | IN($operators[]) or .name | IN($operators[]))
    ' {{ pc_tmp_dir }}/index-packages >> {{ pc_tmp_dir }}/configs/index.json
  register: extract_result
  changed_when: extract_result.rc == 0
