---
# TODO: For nightlies we could sign the artifacts with --signing-key
- name: "Extract artifacts from release image"
  shell:
    cmd: >
      {{ oc_tool_path }} adm release extract
      --registry-config {{ auths_file }}
      --tools
      --from {{ pull_url }}
      --to "{{ dir }}"

- name: "Get release digest"
  shell: >
    set -o pipefail &&
    grep '^Digest:' {{ dir }}/release.txt
    | tr -s ' '
    | cut -d ' ' -f 2
  register: release_digest
  changed_when: false
  when:
    - build != "nightly"

- name: "Download release signature"
  include_tasks: fetch.yml
  vars:
    uri: "https://mirror.openshift.com/pub/openshift-v4/signatures/openshift/release/{{ release_digest.stdout | replace(':', '=') }}/signature-1"
  when:
    - build != "nightly"

...
