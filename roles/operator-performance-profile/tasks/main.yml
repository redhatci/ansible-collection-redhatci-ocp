---
- name: Create namespace for Performance Addon operator
  k8s:
    definition:
      apiVersion: v1
      kind: Namespace
      metadata:
        labels:
          openshift.io/cluster-monitoring: "true"
        name: openshift-performance-addon-operator
      spec: {}

- name: Create operatorgroup for Performance Addon operator
  k8s:
    definition:
      apiVersion: operators.coreos.com/v1
      kind: OperatorGroup
      metadata:
        name: openshift-performance-addon-operatorgroup
        namespace: openshift-performance-addon-operator

- name: Create subscription for Performance Addon operator without channel
  k8s:
    definition:
      apiVersion: operators.coreos.com/v1alpha1
      kind: Subscription
      metadata:
        name: performance-addon-operator-subscription
        namespace: openshift-performance-addon-operator
      spec:
        name: performance-addon-operator
        source: "{{ opm_catalog_source_name }}"
        sourceNamespace: "{{ opm_catalog_source_namespace | default('openshift-marketplace') }}"

- name: test_ Check if performance-addon-operator csv is installed
  k8s_info:
    api: operators.coreos.com/v1alpha1
    namespace: openshift-performance-addon-operator
    kind: ClusterServiceVersion
  register: csv
  retries: 50
  delay: 5
  until:
    - "csv.resources|length == 1"
    - "'status' in csv.resources[0]"
    - "'phase' in csv.resources[0].status"
    - ("csv.resources[0].status.phase == 'Succeeded'" or "csv.resources[0].status.phase == 'Present'")
...
