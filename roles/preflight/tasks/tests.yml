---
# If you want to run preflight tests,
# preflight_operators_to_check variable should be provided
# in the config file -e @path/to/preflight_config.yaml
- name: Preflight check operator bundle images one by one
  include_tasks: test_preflight_check_container.yml
  loop: "{{ preflight_operators_to_check }}"
  loop_control:
    loop_var: operator

- name: Preflight check operators one by one
  include_tasks: tests_preflight_check_operator.yml
  loop: "{{ preflight_operators_to_check }}"
  loop_control:
    loop_var: operator

# If you want to run operator-sdk scorecard tests,
# operator_sdk_tool_path variable should be provided
# in the config file -e @path/to/preflight_config.yaml
- name: Display fail message if the path to operator-sdk binary is not provided
  fail:
    msg: Impossible to run operator-sdk tests. Please provide operator_sdk_tool_path variable in config file.
  when: operator_sdk_tool_path is undefined
  ignore_errors: true

# These tests are here to retrieve the logs,
# which are not displayed by preflight.
# TODO: remove them once the issue is fixed
# https://github.com/redhat-openshift-ecosystem/openshift-preflight/issues/169
- name: Scorecard tests
  include_tasks: tests_scorecard_check_operator.yml
  loop: "{{ preflight_operators_to_check }}"
  loop_control:
    loop_var: operator
  when: operator_sdk_tool_path is defined

- name: Remove tmp directory
  file:
    path: "{{ preflight_ca_tmp_dir.path }}"
    state: absent
  when:
    - preflight_ca_tmp_dir is defined
...
