---
- name: Create tmp directory for custom configurations and preflight binary
  tempfile:
    state: directory
    prefix: preflight_tmp_dir.
  register: preflight_tmp_dir

- name: Download preflight binary if necessary
  vars:
    preflight_binary_dir: "{{ preflight_tmp_dir.path }}/preflight/{{ preflight_version.split(':')[-1] }}"
  include_tasks: pre-run_get_preflight_binary.yml
  when: preflight_use_binary | bool

# This task is used both in connected and disconnected env
# to retrieve scorecard-test image to run independent scorecard tests later on
- name: Run preflight runtime-assets to get scorecard-test image
  include_tasks: pre-run_runtime_assets.yml

- name: Manage images mirroring for Preflight cert suite
  include_tasks: pre-run_mirroring.yml
  when: dci_disconnected | default(false) | bool

- name: Copy kubeconfig file into tmp config directory
  copy:
    src: "{{ kubeconfig_path }}"
    dest: "{{ preflight_tmp_dir.path }}"

# Use custom certificat for self sign registry
- name: Get custom ca certificate for preflight
  include_tasks: prepare_custom_certificate.yml
  when: preflight_custom_ca | length

# Use authentication file for private registry
- name: Set authentication for registry access
  include_tasks: prepare_json_authentication.yml
  when: partner_creds | length
...
